#!/usr/bin/env bash

set -euo pipefail

unset bump

while getopts "Mmp" opt; do
    case $opt in
    M) bump='major' ;;
    m) bump='minor' ;;
    p) bump='patch' ;;
    *) exit 2 ;;
    esac
done
shift $((OPTIND - 1))

read -r name version < <(uv version)

if [[ ! -v bump ]]; then
    printf "%s\n" "$version"
    exit
fi

uv version --bump "$bump"

version_file=./src/$name/version
version=$(uv version --short)
printf "%s\n" "$version" >"$version_file"

git add "$version_file" uv.lock pyproject.toml
git commit -m "Bump $bump version"
git tag "v$version"
